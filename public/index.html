<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>React + Webpack</title>
  </head>

  <body>
    <h1>Embeddable Widget Demo</h1>
    <div>
      <button id="open-btn">Open</button>
      <button id="close-btn">Close</button>
      <button id="toggle-btn">Toggle</button>
      <button id="destroy-btn">Destroy</button>
    </div>
    <script>
      function loadDocsBotAI(opts) {
        const script = document.createElement("script");
        script.src = "/docsbotai-widget.js";
        script.async = true;
        script.type = "text/javascript";
        document.body.append(script);

        script.addEventListener("load", () => {
          DocsBotAI.init({
            id: "ZrbLG98bbxZ9EFqiPvyl/SQMV36O8xi43xbZRzYLy",
            supportCallback: function (event, history) {
              event.preventDefault();
              console.log(history, DocsBotAI);
            },
          });

          let waitForElm;
          waitForElem = function waitForElm(selector) {
            return new Promise((resolve) => {
              if (document.querySelector(selector)) {
                return resolve(document.querySelector(selector));
              }

              const observer = new MutationObserver((mutations) => {
                if (document.querySelector(selector)) {
                  resolve(document.querySelector(selector));
                  observer.disconnect();
                }
              });

              observer.observe(document.body, {
                childList: true,
                subtree: true,
              });
            });
          };

          if (waitForElem) {
            waitForElem("#docsbotai-root").then(() => {
              console.log("mounted");
              const openBtn = document.getElementById("open-btn");
              openBtn.addEventListener("click", () => {
                DocsBotAI.open();
              });

              const closeBtn = document.getElementById("close-btn");
              closeBtn.addEventListener("click", () => {
                DocsBotAI.close();
              });

              const toggleBtn = document.getElementById("toggle-btn");
              toggleBtn.addEventListener("click", () => {
                DocsBotAI.toggle();
              });

              const destroyBtn = document.getElementById("destroy-btn");
              destroyBtn.addEventListener("click", () => {
                DocsBotAI.unmount();
              });
            });
          }
        });
      }

      loadDocsBotAI();
    </script>
  </body>
</html>
