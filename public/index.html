<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>React + Webpack</title>
  </head>

  <body style="background-color: dimgray;">
    <h1>Embeddable Widget Demo</h1>
    <div>
      <button id="open-btn">Open</button>
      <button id="close-btn">Close</button>
      <button id="toggle-btn">Toggle</button>
      <button id="destroy-btn">Destroy</button>
      <button id="reinit-btn">Reinitialize</button>
    </div>
    <script>
      window.DocsBotAI = window.DocsBotAI || {};

      DocsBotAI.init = function (opts) {
        return new Promise((resolve, reject) => {
          var script = document.createElement("script");
          script.type = "text/javascript";
          script.async = true;
          script.src = "/chat.js";
          const el = document.getElementsByTagName("script")[0];
          el.parentNode.insertBefore(script, el);

          script.addEventListener("load", () => {
            window.DocsBotAI.mount({
              id: opts.id,
              supportCallback: opts.supportCallback,
            });

            let waitForElem;
            waitForElem = function waitForElm(selector) {
              return new Promise((resolve) => {
                if (document.querySelector(selector)) {
                  return resolve(document.querySelector(selector));
                }

                const observer = new MutationObserver((mutations) => {
                  if (document.querySelector(selector)) {
                    resolve(document.querySelector(selector));
                    observer.disconnect();
                  }
                });

                observer.observe(document.body, {
                  childList: true,
                  subtree: true,
                });
              });
            };

            if (waitForElem) {
              waitForElem("#docsbotai-root").then(resolve).catch(reject);
            }
          });

          script.addEventListener("error", (error) => {
            reject(esrror.message);
          });
        });
      };

      DocsBotAI.init({
        id: "ZrbLG98bbxZ9EFqiPvyl/UMADr9eozeBQ8sZKr0GW",
        supportCallback: function (event, history) {
          event.preventDefault();
          console.log(history, DocsBotAI);
        },
      }).then(() => {
        //  Script is safely loaded, you can do whatever you want from here with bot
        const openBtn = document.getElementById("open-btn");
        openBtn.addEventListener("click", () => {
          DocsBotAI.open();
        });

        const closeBtn = document.getElementById("close-btn");
        closeBtn.addEventListener("click", () => {
          DocsBotAI.close();
        });

        const toggleBtn = document.getElementById("toggle-btn");
        toggleBtn.addEventListener("click", () => {
          DocsBotAI.toggle();
        });

        const destroyBtn = document.getElementById("destroy-btn");
        destroyBtn.addEventListener("click", () => {
          console.log("%cDocsBotAI", "color:cyan; ", DocsBotAI.unmount);
          DocsBotAI.unmount();
        });

        const reinitBtn = document.getElementById("reinit-btn");
        reinitBtn.addEventListener("click", () => {
          DocsBotAI.mount({
            id: "ZrbLG98bbxZ9EFqiPvyl/SQMV36O8xi43xbZRzYLy",
            supportCallback: function (event, history) {
              event.preventDefault();
              console.log(history, DocsBotAI);
            },
          });
        });
      });
    </script>
  </body>
</html>
